/*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
/*Ё                                                                          Ё*/
/*Ё PROGRAM NAME: PMSPY                                                      Ё*/
/*Ё -------------                                                            Ё*/
/*Ё  A PM program that is used to look at or 'spy' on the message queue of   Ё*/
/*Ё  other PM applications windows.                                          Ё*/
/*Ё                                                                          Ё*/
/*Ё COPYRIGHT:                                                               Ё*/
/*Ё ----------                                                               Ё*/
/*Ё  Copyright (C) International Business Machines Corp., 1992               Ё*/
/*Ё                                                                          Ё*/
/*Ё DISCLAIMER OF WARRANTIES:                                                Ё*/
/*Ё -------------------------                                                Ё*/
/*Ё  The following [enclosed] code is sample code created by IBM Corporation.Ё*/
/*Ё  This sample code is not part of any standard IBM product and is providedЁ*/
/*Ё  to you solely for the purpose of assisting you in the development of    Ё*/
/*Ё  your applications.  The code is provided "AS IS", without warranty of   Ё*/
/*Ё  any kind.  IBM shall not be liable for any damages arising out of your  Ё*/
/*Ё  use of the sample code, even if they have been advised of the           Ё*/
/*Ё  possibility of such damages.                                            Ё*/
/*Ё                                                                          Ё*/
/*Ё For details on what this program does etc., please see the PMSPY.C file. Ё*/
/*Ё                                                                          Ё*/
/*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

/*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
/*Ё PMSPYFON.C                                                               Ё*/
/*Ё                                                                          Ё*/
/*Ё Font Selection Dialog Procedure                                          Ё*/
/*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

#include "pmspy.h"
/*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
/*Ё Internal Function: DismissDialog                                         Ё*/
/*Ё                                                                          Ё*/
/*Ё                                                                          Ё*/
/*Ё Function:                                                                Ё*/
/*Ё                                                                          Ё*/
/*Ё   This module: 1) sets the flag indicating if entered data should        Ё*/
/*Ё                   be used by invoker of dialog                           Ё*/
/*Ё                2) POSTs message to invoker of dialog                     Ё*/
/*Ё                3) Dismisses the dialog                                   Ё*/
/*Ё                                                                          Ё*/
/*Ё Input:                                                                   Ё*/
/*Ё       DlgHwnd.......dialog handle to dismiss                             Ё*/
/*Ё       DlgData.......pointer to dialog's PFONT_DATA structure             Ё*/
/*Ё       DlgUse........indicator if entered FONT data should be used        Ё*/
/*Ё                                                                          Ё*/
/*Ё Output:                                                                  Ё*/
/*Ё                                                                          Ё*/
/*Ё   - N O N E                                                              Ё*/
/*Ё                                                                          Ё*/
/*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

static
void DismissDialog(HWND              hwndDlg,
                   PFONT_DATA        pDlgData,
                   register BOOL     fDlgUse)

{
  /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
  /*Ё Set the flag for caller's interrogation                                Ё*/
  /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

  pDlgData->fUseData = fDlgUse;

  /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
  /*Ё Post REPLY message to caller                                           Ё*/
  /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

  WinPostMsg(pDlgData->hwndNotify,
             pDlgData->uNotifyMsg,
             MPFROMP(pDlgData),
             MPFROMP(NULL) );

  /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
  /*Ё Dismiss the dialog                                                     Ё*/
  /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

  WinDismissDlg(hwndDlg, fDlgUse);        /* Close the Dialog box         */
}


 MRESULT  FontDlgProc(          HWND    hWnd,
                       register ULONG   usMsg,
                                MPARAM  mp1,
                                MPARAM  mp2 )

{
  /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
  /*Ё Local Variables                                                        Ё*/
  /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

  MRESULT    dpResult = NULL;          /* result of current MSG processing */
  USHORT     usItem;

  /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
  /*Ё Obtain pointer to this dialog's instance data                          Ё*/
  /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

  PFONT_DATA pData = (PFONT_DATA) WinQueryWindowPtr(hWnd, QWL_USER);

  /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
  /*Ё Process the message                                                    Ё*/
  /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

  switch ( usMsg )
    {
      /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
      /*Ё One of the pushbuttons has been used....                           Ё*/
      /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

      case WM_COMMAND:

        switch( LOUSHORT( mp1 ) )
        {
           /*зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
           /*Ё Process selected FONT                                         Ё*/
           /*юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

           case DID_OK:

                /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
                /*Ё Determine selected FONT                                  Ё*/
                /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

                usItem = (USHORT)
                         WinSendDlgItemMsg(hWnd,
                                           DLG_FONT_LB,
                                           LM_QUERYSELECTION,
                                           MPFROMSHORT(LIT_FIRST),
                                           MPFROMP(NULL));

                pData->pfnSelected = (PFONTNAME)
                                     WinSendDlgItemMsg(hWnd,
                                                       DLG_FONT_LB,
                                                       LM_QUERYITEMHANDLE,
                                                       MPFROMSHORT(usItem),
                                                       MPFROMP(NULL));
                DismissDialog(hWnd, pData, TRUE);

           break;

           /*зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
           /*Ё User cancelled exclusion/inclusion                            Ё*/
           /*юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

           case DID_CANCEL:

                DismissDialog(hWnd, pData, FALSE);

           break;
        }

        break;                                        /* Break WM_COMMAND           */

      /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
      /*Ё WM_CLOSE:                                                          Ё*/
      /*Ё - Dismiss the dialog, but DO NOT use results...                    Ё*/
      /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

      case WM_CLOSE:
           DismissDialog(hWnd, pData, FALSE);
      break;

      /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
      /*Ё WM_INITDLG:                                                        Ё*/
      /*Ё                                                                    Ё*/
      /*Ё - save dialog instance data pointer                                Ё*/
      /*Ё                                                                    Ё*/
      /*Ё - MP2 = PFONT_DATA                                                 Ё*/
      /*Ё                                                                    Ё*/
      /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

      case WM_INITDLG:
           {
             PFONTNAME  pFont;

             /*зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
             /*Ё Save Dialog's instance data pointer (passed in MP2)         Ё*/
             /*юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

             WinSetWindowPtr(hWnd, QWL_USER, pData = (PFONT_DATA)mp2);

             /*зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
             /*Ё Add all FONTS to list box                                   Ё*/
             /*юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

             for( /* Initialize */  pFont = pData->pfnList; /* @ first FONT */
                  /* Terminate  */  *pFont[0] != 0;         /* stop at EOT */
                  /* Iterate    */  pFont++                 /* try next FONT */
                )
             {
               usItem = (USHORT)
                         WinSendDlgItemMsg(hWnd,
                                           DLG_FONT_LB,
                                           LM_INSERTITEM,
                                           MPFROMSHORT(LIT_SORTASCENDING),
                                           MPFROMP(pFont) ); /* FONT Name */
               WinSendDlgItemMsg(hWnd,
                                 DLG_FONT_LB,
                                 LM_SETITEMHANDLE,
                                 MPFROMSHORT(usItem),
                                 MPFROMP(pFont) );
             }

            /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
            /*Ё See if "current" FONT exists...automatically select and      Ё*/
            /*Ё make it the "top" item                                       Ё*/
            /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

            if ( (pData->pfnCurrent != NULL ) &&
                 ( (usItem = SHORT1FROMMR(
                             WinSendDlgItemMsg(hWnd,
                                               DLG_FONT_LB,
                                               LM_SEARCHSTRING,
                                               MPFROM2SHORT(LSS_CASESENSITIVE |
                                                            LSS_PREFIX,
                                                            LIT_FIRST),
                                               MPFROMP(pData->pfnCurrent))) )
                   != (USHORT)LIT_NONE )
               )
            {
              WinSendDlgItemMsg(hWnd,                    /* select "current" */
                                DLG_FONT_LB,
                                LM_SELECTITEM,
                                MPFROMSHORT(usItem),
                                MPFROMSHORT(TRUE));

              WinSendDlgItemMsg(hWnd,                    /* make "top" item */
                                DLG_FONT_LB,
                                LM_SETTOPINDEX,
                                MPFROMSHORT(usItem),
                                MPFROMP(NULL));
            }

             CenterDialog(hWnd);                        /* Center the Dialog */

           }

        break;

      /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
      /*Ё We don't need to handle any other messages...                      Ё*/
      /*Ё                                                                    Ё*/
      /*Ё If this isn't an IPF message, let PM do it's default "thing"       Ё*/
      /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

      default:
           if ( !HandleIPF(hWnd, usMsg, mp1, mp2, &dpResult) )
             dpResult = WinDefDlgProc(hWnd,       /* Dialog Handle                */
                                      usMsg,      /* Message                      */
                                      mp1,        /* First parameter for message. */
                                      mp2);       /* Second parameter for message.*/

   } /* End MSG switch */

  /*здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©*/
  /*Ё Exit                                                                   Ё*/
  /*юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/

  return( dpResult );
}
